<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sports Day 2025 - Results Tabulation</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; padding:20px;}
    .container { max-width:1400px; margin:0 auto; background:#fff; border-radius:20px; box-shadow:0 20px 40px rgba(0,0,0,.1); overflow:hidden; }
    .header { background:linear-gradient(45deg,#ff6b6b,#4ecdc4); color:#fff; padding:30px; text-align:center; position:relative;}
    .header h1 { font-size:2.5em; margin-bottom:10px; text-shadow:2px 2px 4px rgba(0,0,0,.3); }
    .sync-status { position:absolute; top:20px; right:20px; background:rgba(255,255,255,.2); padding:10px 15px; border-radius:8px; font-size:.9em;}
    .sync-indicator{display:inline-block;width:8px;height:8px;background:#4ecdc4;border-radius:50%;margin-right:5px;animation:pulse 2s infinite;}
    @keyframes pulse{0%,100%{opacity:1;}50%{opacity:.5;}}
    .tabs{display:flex;background:#f8f9fa;border-bottom:3px solid #e9ecef;}
    .tab{flex:1;padding:20px;text-align:center;cursor:pointer;font-weight:bold;transition:.3s;border-bottom:4px solid transparent;}
    .tab.active{background:#fff;border-bottom-color:#4ecdc4;color:#4ecdc4;}
    .tab:hover:not(.active){background:#e9ecef;}
    .content{padding:30px;}
    .section{display:none;}
    .section.active{display:block;}
    .input-section{background:#f8f9fa;padding:25px;border-radius:15px;margin-bottom:30px;border-left:5px solid #4ecdc4;}
    .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:20px;}
    .form-group{display:flex;flex-direction:column;}
    label{font-weight:bold;margin-bottom:8px;color:#333;}
    select,input{padding:12px;border:2px solid #ddd;border-radius:8px;font-size:16px;transition:border-color .3s;}
    select:focus,input:focus{outline:none;border-color:#4ecdc4;}
    .student-info-display{font-size:.9em;color:#666;margin-top:5px;font-style:italic;}
    .btn{background:linear-gradient(45deg,#4ecdc4,#44a08d);color:#fff;border:none;padding:15px 30px;border-radius:10px;font-size:16px;font-weight:bold;cursor:pointer;transition:transform .2s;margin-right:10px;}
    .btn:hover{transform:translateY(-2px);} .btn:disabled{background:#ccc;cursor:not-allowed;transform:none;}
    .btn-danger{background:linear-gradient(45deg,#ff6b6b,#ee5a52);} .btn-secondary{background:linear-gradient(45deg,#6c757d,#495057);}
    .results-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:30px;margin-top:30px;}
    .results-card{background:#fff;border-radius:15px;padding:25px;box-shadow:0 10px 20px rgba(0,0,0,.1);border-left:5px solid #ff6b6b;}
    .results-card h3{color:#333;margin-bottom:20px;font-size:1.3em;}
    .leaderboard{list-style:none;}
    .leaderboard li{display:flex;justify-content:space-between;align-items:center;padding:12px;margin-bottom:10px;background:#f8f9fa;border-radius:8px;border-left:4px solid #ddd;}
    .leaderboard li.gold{border-left-color:#ffd700;background:linear-gradient(90deg,#fff9c4,#f8f9fa);}
    .leaderboard li.silver{border-left-color:#c0c0c0;background:linear-gradient(90deg,#f5f5f5,#f8f9fa);}
    .leaderboard li.bronze{border-left-color:#cd7f32;background:linear-gradient(90deg,#f4e4bc,#f8f9fa);}
    .student-info{flex:1;} .student-name{font-weight:bold;color:#333;} .student-details{font-size:.9em;color:#666;}
    .points{font-weight:bold;font-size:1.1em;color:#4ecdc4;}
    .house-colors{display:inline-block;width:20px;height:20px;border-radius:50%;margin-right:10px;vertical-align:middle;}
    .chrysanthemum{background-color:#ffd700;} .hibiscus{background-color:#ff69b4;} .orchid{background-color:#9370db;} .sunflower{background-color:#ffa500;}
    .event-log{max-height:400px;overflow-y:auto;background:#f8f9fa;border-radius:10px;padding:20px;}
    .event-entry{background:#fff;margin-bottom:15px;padding:15px;border-radius:8px;border-left:4px solid #4ecdc4;}
    .export-section{margin-top:30px;text-align:center;}
    .alert{padding:15px;border-radius:8px;margin-bottom:20px;}
    .alert-success{background:#d4edda;border:1px solid #c3e6cb;color:#155724;}
    .alert-error{background:#f8d7da;border:1px solid #f5c6cb;color:#721c24;}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px;}
    .stat-card{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:20px;border-radius:10px;text-align:center;}
    .stat-number{font-size:2.5em;font-weight:bold;margin-bottom:5px;}
    .stat-label{font-size:0.9em;opacity:0.9;}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="sync-status"><span class="sync-indicator"></span>Live System</div>
      <h1>üèÜ Sports Day 2025</h1>
      <p>Results Tabulation System</p>
    </div>

    <div class="tabs">
      <div class="tab active" onclick="showTab(event,'input')">üìù Input Results</div>
      <div class="tab" onclick="showTab(event,'athletes')">ü•á Best Athletes</div>
      <div class="tab" onclick="showTab(event,'houses')">üè† House Champions</div>
      <div class="tab" onclick="showTab(event,'events')">üìä Event Log</div>
    </div>

    <div class="content">
      <!-- Input Section -->
      <div id="input" class="section active">
        <div id="inputAlert" class="alert" style="display:none;"></div>

        <!-- Quick Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="totalEvents">0</div>
            <div class="stat-label">Events Completed</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalMedals">0</div>
            <div class="stat-label">Medals Awarded</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="leadingHouse">-</div>
            <div class="stat-label">Leading House</div>
          </div>
        </div>

        <div class="input-section">
          <h2>üéØ Add Event Results</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="eventType">Event Type</label>
              <select id="eventType" onchange="updateCategoryOptions()">
                <option value="">Select Event</option>
                <option value="school_jam">School Jam (200 pts)</option>
                <option value="tug_of_war">Tug of War (200 pts)</option>
                <option value="100m">100m Race</option>
                <option value="200m">200m Race</option>
                <option value="400m">400m Race</option>
                <option value="800m">800m Race</option>
                <option value="4x100m">4x100m Relay</option>
                <option value="long_jump">Long Jump</option>
                <option value="high_jump">High Jump</option>
                <option value="shot_put">Shot Put</option>
                <option value="discus">Discus</option>
                <option value="javelin">Javelin</option>
              </select>
            </div>
            <div class="form-group">
              <label for="category">Category</label>
              <select id="category" onchange="updateFormFields()">
                <option value="">Select Category</option>
                <optgroup label="Grade 4">
                  <option value="grade4_100m_boys">Grade 4 - 100m Boys</option>
                  <option value="grade4_100m_girls">Grade 4 - 100m Girls</option>
                  <option value="grade4_hyrox_boys">Grade 4 - HYROX Boys</option>
                  <option value="grade4_hyrox_girls">Grade 4 - HYROX Girls</option>
                </optgroup>
                <optgroup label="Grade 5">
                  <option value="grade5_100m_boys">Grade 5 - 100m Boys</option>
                  <option value="grade5_100m_girls">Grade 5 - 100m Girls</option>
                  <option value="grade5_hyrox_boys">Grade 5 - HYROX Boys</option>
                  <option value="grade5_hyrox_girls">Grade 5 - HYROX Girls</option>
                </optgroup>
                <optgroup label="Under 12">
                  <option value="u12_100m_boys">Under 12 - 100m Boys</option>
                  <option value="u12_100m_girls">Under 12 - 100m Girls</option>
                  <option value="u12_hyrox_boys">Under 12 - HYROX Boys</option>
                  <option value="u12_hyrox_girls">Under 12 - HYROX Girls</option>
                </optgroup>
                <optgroup label="Under 14">
                  <option value="u14_100m_boys">Under 14 - 100m Boys</option>
                  <option value="u14_100m_girls">Under 14 - 100m Girls</option>
                  <option value="u14_hyrox_boys">Under 14 - HYROX Boys</option>
                  <option value="u14_hyrox_girls">Under 14 - HYROX Girls</option>
                </optgroup>
                <optgroup label="Under 16">
                  <option value="u16_100m_boys">Under 16 - 100m Boys</option>
                  <option value="u16_100m_girls">Under 16 - 100m Girls</option>
                  <option value="u16_hyrox_boys">Under 16 - HYROX Boys</option>
                  <option value="u16_hyrox_girls">Under 16 - HYROX Girls</option>
                </optgroup>
                <optgroup label="Open">
                  <option value="4x100m_relay">4x100m Open Relay</option>
                </optgroup>
              </select>
            </div>
          </div>

          <!-- Podium pickers -->
          <div class="form-grid">
            <div class="form-group">
              <label>ü•á Gold Winner</label>
              <div id="goldWinnerContainer">
                <select id="goldWinner" onchange="updateWinnerInfo('gold')">
                  <option value="">Select Student</option>
                </select>
              </div>
              <div id="goldWinnerInfo" class="student-info-display"></div>
            </div>
            <div class="form-group">
              <label for="goldHouse">House</label>
              <select id="goldHouse">
                <option value="">Select House</option>
                <option value="Chrysanthemum">Chrysanthemum</option>
                <option value="Hibiscus">Hibiscus</option>
                <option value="Orchid">Orchid</option>
                <option value="Sunflower">Sunflower</option>
              </select>
            </div>
          </div>

          <div class="form-grid" id="silverSection">
            <div class="form-group">
              <label>ü•à Silver Winner</label>
              <div id="silverWinnerContainer">
                <select id="silverWinner" onchange="updateWinnerInfo('silver')">
                  <option value="">Select Student</option>
                </select>
              </div>
              <div id="silverWinnerInfo" class="student-info-display"></div>
            </div>
            <div class="form-group">
              <label for="silverHouse">House</label>
              <select id="silverHouse">
                <option value="">Select House</option>
                <option value="Chrysanthemum">Chrysanthemum</option>
                <option value="Hibiscus">Hibiscus</option>
                <option value="Orchid">Orchid</option>
                <option value="Sunflower">Sunflower</option>
              </select>
            </div>
          </div>

          <div class="form-grid" id="bronzeSection">
            <div class="form-group">
              <label>ü•â Bronze Winner</label>
              <div id="bronzeWinnerContainer">
                <select id="bronzeWinner" onchange="updateWinnerInfo('bronze')">
                  <option value="">Select Student</option>
                </select>
              </div>
              <div id="bronzeWinnerInfo" class="student-info-display"></div>
            </div>
            <div class="form-group">
              <label for="bronzeHouse">House</label>
              <select id="bronzeHouse">
                <option value="">Select House</option>
                <option value="Chrysanthemum">Chrysanthemum</option>
                <option value="Hibiscus">Hibiscus</option>
                <option value="Orchid">Orchid</option>
                <option value="Sunflower">Sunflower</option>
              </select>
            </div>
          </div>

          <div style="margin-top:20px;">
            <button class="btn" onclick="addResult()">‚ûï Add Result</button>
            <button class="btn btn-secondary" onclick="clearForm()">üîÑ Clear Form</button>
          </div>
        </div>
      </div>

      <!-- Best Athletes Section -->
      <div id="athletes" class="section">
        <h2>üèÜ Best Athletes Leaderboard</h2>
        <div class="results-grid">
          <div class="results-card"><h3>Grade 4 - 100m</h3><ul id="grade4-100m-list" class="leaderboard"></ul></div>
          <div class="results-card"><h3>Grade 4 - HYROX</h3><ul id="grade4-hyrox-list" class="leaderboard"></ul></div>
          <div class="results-card"><h3>Grade 5 - 100m</h3><ul id="grade5-100m-list" class="leaderboard"></ul></div>
          <div class="results-card"><h3>Grade 5 - HYROX</h3><ul id="grade5-hyrox-list" class="leaderboard"></ul></div>
          <div class="results-card"><h3>Under 12 - 100m</h3><ul id="u12-100m-list" class="leaderboard"></ul></div>
          <div class="results-card"><h3>Under 12 - HYROX</h3><ul id="u12-hyrox-list" class="leaderboard"></ul></div>
          <div class="results-card"><h3>Under 14 - 100m</h3><ul id="u14-100m-list" class="leaderboard"></ul></div>
          <div class="results-card"><h3>Under 14 - HYROX</h3><ul id="u14-hyrox-list" class="leaderboard"></ul></div>
          <div class="results-card"><h3>Under 16 - 100m</h3><ul id="u16-100m-list" class="leaderboard"></ul></div>
          <div class="results-card"><h3>Under 16 - HYROX</h3><ul id="u16-hyrox-list" class="leaderboard"></ul></div>
          <div class="results-card"><h3>4x100m Open Relay</h3><ul id="4x100m-relay-list" class="leaderboard"></ul></div>
        </div>
      </div>

      <!-- House Champions Section -->
      <div id="houses" class="section">
        <h2>üè† Overall House Championship</h2>
        <div class="results-card">
          <h3>House Standings</h3>
          <ul id="house-standings" class="leaderboard"></ul>
        </div>
      </div>

      <!-- Event Log Section -->
      <div id="events" class="section">
        <h2>üìã Event Results Log</h2>
        <div class="event-log" id="eventLog">
          <p style="text-align:center;color:#666;">No events recorded yet. Start adding results!</p>
        </div>
        <div class="export-section">
          <button class="btn" onclick="exportResults()">üìä Export to CSV</button>
          <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- PRELOADED STUDENT DATA FROM CSV ---
    <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sports Day 2025 - Results Tabulation</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f0f2f5;
      min-height: 100vh;
      padding: 20px;
    }
    .container { 
      max-width: 1400px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,.07);
      overflow: hidden;
    }
    .header { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 40px 30px;
      text-align: center;
    }
    .header h1 { 
      font-size: 2.2em;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .header p {
      opacity: 0.9;
      font-size: 1.05em;
    }
    .tabs {
      display: flex;
      background: #fff;
      border-bottom: 1px solid #e5e7eb;
      padding: 0 20px;
    }
    .tab {
      padding: 18px 24px;
      cursor: pointer;
      font-weight: 500;
      color: #6b7280;
      transition: all 0.2s;
      border-bottom: 3px solid transparent;
      margin-bottom: -1px;
    }
    .tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }
    .tab:hover:not(.active) {
      color: #374151;
    }
    .content {
      padding: 30px;
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }
    
    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: #fff;
      border: 1px solid #e5e7eb;
      padding: 24px;
      border-radius: 12px;
      text-align: center;
    }
    .stat-number {
      font-size: 2.5em;
      font-weight: 700;
      color: #111827;
      margin-bottom: 4px;
    }
    .stat-label {
      font-size: 0.875em;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    /* Forms */
    .input-section {
      background: #fff;
      border: 1px solid #e5e7eb;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
    }
    .input-section h2 {
      font-size: 1.5em;
      font-weight: 600;
      margin-bottom: 24px;
      color: #111827;
    }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
    }
    label {
      font-weight: 500;
      margin-bottom: 8px;
      color: #374151;
      font-size: 0.875em;
    }
    select, input {
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 15px;
      transition: border-color 0.2s;
      background: #fff;
    }
    select:focus, input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .student-info-display {
      font-size: 0.8em;
      color: #6b7280;
      margin-top: 4px;
    }
    
    /* Buttons */
    .btn {
      background: #667eea;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      margin-right: 10px;
    }
    .btn:hover {
      background: #5a67d8;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
    }
    .btn-secondary {
      background: #6b7280;
    }
    .btn-secondary:hover {
      background: #4b5563;
    }
    .btn-danger {
      background: #ef4444;
    }
    .btn-danger:hover {
      background: #dc2626;
    }
    
    /* Results Cards */
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
      gap: 24px;
      margin-top: 24px;
    }
    .results-card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 24px;
    }
    .results-card h3 {
      color: #111827;
      margin-bottom: 16px;
      font-size: 1.1em;
      font-weight: 600;
    }
    
    /* Leaderboard */
    .leaderboard {
      list-style: none;
    }
    .leaderboard li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      margin-bottom: 8px;
      background: #f9fafb;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }
    .leaderboard li.gold {
      background: linear-gradient(90deg, #fef3c7, #fef9e7);
      border-color: #fbbf24;
    }
    .leaderboard li.silver {
      background: linear-gradient(90deg, #f3f4f6, #f9fafb);
      border-color: #9ca3af;
    }
    .leaderboard li.bronze {
      background: linear-gradient(90deg, #fed7aa, #fef5e7);
      border-color: #f97316;
    }
    .student-info {
      flex: 1;
    }
    .student-name {
      font-weight: 600;
      color: #111827;
      margin-bottom: 2px;
    }
    .student-details {
      font-size: 0.8em;
      color: #6b7280;
    }
    .points {
      font-weight: 700;
      font-size: 1.1em;
      color: #667eea;
    }
    
    /* House Colors */
    .house-colors {
      display: inline-block;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      margin-right: 8px;
      vertical-align: middle;
    }
    .chrysanthemum { background-color: #fbbf24; }
    .hibiscus { background-color: #ec4899; }
    .orchid { background-color: #a78bfa; }
    .sunflower { background-color: #fb923c; }
    
    /* Event Log */
    .event-log {
      max-height: 400px;
      overflow-y: auto;
      background: #f9fafb;
      border-radius: 8px;
      padding: 16px;
      border: 1px solid #e5e7eb;
    }
    .event-entry {
      background: #fff;
      margin-bottom: 12px;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }
    .event-entry strong {
      color: #111827;
    }
    
    /* Alerts */
    .alert {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 0.95em;
    }
    .alert-success {
      background: #d1fae5;
      border: 1px solid #6ee7b7;
      color: #065f46;
    }
    .alert-error {
      background: #fee2e2;
      border: 1px solid #fca5a5;
      color: #991b1b;
    }
    
    .export-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üèÜ Sports Day 2025</h1>
      <p>Results Tabulation System</p>
    </div>

    <div class="tabs">
      <div class="tab active" onclick="showTab(event,'input')">Input Results</div>
      <div class="tab" onclick="showTab(event,'athletes')">Best Athletes</div>
      <div class="tab" onclick="showTab(event,'houses')">House Standings</div>
      <div class="tab" onclick="showTab(event,'events')">Event Log</div>
    </div>

    <div class="content">
      <!-- Input Section -->
      <div id="input" class="section active">
        <div id="inputAlert" class="alert" style="display:none;"></div>

        <!-- Quick Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="totalEvents">0</div>
            <div class="stat-label">Events Completed</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalMedals">0</div>
            <div class="stat-label">Medals Awarded</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="leadingHouse">-</div>
            <div class="stat-label">Leading House</div>
          </div>
        </div>

        <div class="input-section">
          <h2>Add Event Results</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="eventType">Event Type</label>
              <select id="eventType" onchange="updateCategoryOptions()">
                <option value="">Select Event</option>
                <option value="school_jam">School Jam (200 pts)</option>
                <option value="tug_of_war">Tug of War (200 pts)</option>
                <option value="100m">100m Race</option>
                <option value="4x100m">4x100m Relay</option>
                <option value="hyrox">HYROX</option>
              </select>
            </div>
            <div class="form-group">
              <label for="category">Category</label>
              <select id="category" onchange="updateFormFields()">
                <option value="">Select Category</option>
                <optgroup label="Grade 4">
                  <option value="grade4_100m_boys">Grade 4 - 100m Boys</option>
                  <option value="grade4_100m_girls">Grade 4 - 100m Girls</option>
                  <option value="grade4_hyrox_boys">Grade 4 - HYROX Boys</option>
                  <option value="grade4_hyrox_girls">Grade 4 - HYROX Girls</option>
                </optgroup>
                <optgroup label="Grade 5">
                  <option value="grade5_100m_boys">Grade 5 - 100m Boys</option>
                  <option value="grade5_100m_girls">Grade 5 - 100m Girls</option>
                  <option value="grade5_hyrox_boys">Grade 5 - HYROX Boys</option>
                  <option value="grade5_hyrox_girls">Grade 5 - HYROX Girls</option>
                </optgroup>
                <optgroup label="Under 12">
                  <option value="u12_100m_boys">Under 12 - 100m Boys</option>
                  <option value="u12_100m_girls">Under 12 - 100m Girls</option>
                  <option value="u12_hyrox_boys">Under 12 - HYROX Boys</option>
                  <option value="u12_hyrox_girls">Under 12 - HYROX Girls</option>
                </optgroup>
                <optgroup label="Under 14">
                  <option value="u14_100m_boys">Under 14 - 100m Boys</option>
                  <option value="u14_100m_girls">Under 14 - 100m Girls</option>
                  <option value="u14_hyrox_boys">Under 14 - HYROX Boys</option>
                  <option value="u14_hyrox_girls">Under 14 - HYROX Girls</option>
                </optgroup>
                <optgroup label="Under 16">
                  <option value="u16_100m_boys">Under 16 - 100m Boys</option>
                  <option value="u16_100m_girls">Under 16 - 100m Girls</option>
                  <option value="u16_hyrox_boys">Under 16 - HYROX Boys</option>
                  <option value="u16_hyrox_girls">Under 16 - HYROX Girls</option>
                </optgroup>
                <optgroup label="Open">
                  <option value="4x100m_relay">4x100m Open Relay</option>
                </optgroup>
              </select>
            </div>
          </div>

          <!-- Medal Winners -->
          <div style="margin-top: 24px;">
            <div class="form-grid">
              <div class="form-group">
                <label>Gold Winner</label>
                <div id="goldWinnerContainer">
                  <select id="goldWinner" onchange="updateWinnerInfo('gold')">
                    <option value="">Select Student</option>
                  </select>
                </div>
                <div id="goldWinnerInfo" class="student-info-display"></div>
              </div>
              <div class="form-group">
                <label for="goldHouse">Gold House</label>
                <select id="goldHouse">
                  <option value="">Select House</option>
                  <option value="Chrysanthemum">Chrysanthemum</option>
                  <option value="Hibiscus">Hibiscus</option>
                  <option value="Orchid">Orchid</option>
                  <option value="Sunflower">Sunflower</option>
                </select>
              </div>
            </div>

            <div class="form-grid" id="silverSection">
              <div class="form-group">
                <label>Silver Winner</label>
                <div id="silverWinnerContainer">
                  <select id="silverWinner" onchange="updateWinnerInfo('silver')">
                    <option value="">Select Student</option>
                  </select>
                </div>
                <div id="silverWinnerInfo" class="student-info-display"></div>
              </div>
              <div class="form-group">
                <label for="silverHouse">Silver House</label>
                <select id="silverHouse">
                  <option value="">Select House</option>
                  <option value="Chrysanthemum">Chrysanthemum</option>
                  <option value="Hibiscus">Hibiscus</option>
                  <option value="Orchid">Orchid</option>
                  <option value="Sunflower">Sunflower</option>
                </select>
              </div>
            </div>

            <div class="form-grid" id="bronzeSection">
              <div class="form-group">
                <label>Bronze Winner</label>
                <div id="bronzeWinnerContainer">
                  <select id="bronzeWinner" onchange="updateWinnerInfo('bronze')">
                    <option value="">Select Student</option>
                  </select>
                </div>
                <div id="bronzeWinnerInfo" class="student-info-display"></div>
              </div>
              <div class="form-group">
                <label for="bronzeHouse">Bronze House</label>
                <select id="bronzeHouse">
                  <option value="">Select House</option>
                  <option value="Chrysanthemum">Chrysanthemum</option>
                  <option value="Hibiscus">Hibiscus</option>
                  <option value="Orchid">Orchid</option>
                  <option value="Sunflower">Sunflower</option>
                </select>
              </div>
            </div>
          </div>

          <div style="margin-top:24px;">
            <button class="btn" onclick="addResult()">Add Result</button>
            <button class="btn btn-secondary" onclick="clearForm()">Clear Form</button>
          </div>
        </div>‚ûï Add Result</button>
            <button class="btn btn-secondary" onclick="clearForm()">üîÑ Clear Form</button>
          </div>
        </div>
      </div>

      <!-- Best Athletes Section -->
      <div id="athletes" class="section">
        <h2>Best Athletes Leaderboard</h2>
        <div class="results-grid" id="athleteResults">
          <div style="text-align:center; color:#666; grid-column:1/-1;">No results yet. Start adding event results!</div>
        </div>
      </div>

      <!-- House Champions Section -->
      <div id="houses" class="section">
        <h2>Overall House Championship</h2>
        <div class="results-card">
          <h3>House Standings</h3>
          <ul id="house-standings" class="leaderboard">
            <li><div class="student-info"><div class="student-name"><span class="house-colors chrysanthemum"></span>Chrysanthemum</div><div class="student-details">Position 1</div></div><div class="points">0 pts</div></li>
            <li><div class="student-info"><div class="student-name"><span class="house-colors hibiscus"></span>Hibiscus</div><div class="student-details">Position 2</div></div><div class="points">0 pts</div></li>
            <li><div class="student-info"><div class="student-name"><span class="house-colors orchid"></span>Orchid</div><div class="student-details">Position 3</div></div><div class="points">0 pts</div></li>
            <li><div class="student-info"><div class="student-name"><span class="house-colors sunflower"></span>Sunflower</div><div class="student-details">Position 4</div></div><div class="points">0 pts</div></li>
          </ul>
        </div>
      </div>

      <!-- Event Log Section -->
      <div id="events" class="section">
        <h2>Event Results Log</h2>
        <div class="event-log" id="eventLog">
          <p style="text-align:center;color:#666;">No events recorded yet. Start adding results!</p>
        </div>
        <div class="export-section">
          <button class="btn" onclick="exportResults()">Export to CSV</button>
          <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- COMPLETE STUDENT DATABASE FROM EXCEL ---
    const STUDENT_DATABASE = {
      'grade4_100m_boys': [
        { name: 'Madhav Nair', house: 'Chrysanthemum' },
        { name: 'Eshan Singh', house: 'Hibiscus' },
        { name: 'Om Ganakrishn', house: 'Chrysanthemum' },
        { name: 'Imran Zakariya', house: 'Sunflower' },
        { name: 'Sooryansh Shandilya', house: 'Orchid' },
        { name: 'Sai Santhossh', house: 'Orchid' }
      ],
      'grade4_100m_girls': [
        { name: 'Dhriti Shetty', house: 'Hibiscus' },
        { name: 'Ameya Sharma', house: 'Sunflower' },
        { name: 'Prisha Magadum', house: 'Hibiscus' },
        { name: 'Riyanshi Ara', house: 'Orchid' },
        { name: 'Jingwen Zuo', house: 'Sunflower' },
        { name: 'Tia Karamchandani', house: 'Chrysanthemum' },
        { name: 'Bani Bhardwaj', house: 'Orchid' },
        { name: 'Anaisha Singh', house: 'Orchid' },
        { name: 'Aadhya Ramachandran', house: 'Hibiscus' }
      ],
      'grade4_hyrox_boys': [
        { name: 'Madhav Nair', house: 'Chrysanthemum' },
        { name: 'Eshan Singh', house: 'Hibiscus' },
        { name: 'Om Ganakrishn', house: 'Chrysanthemum' },
        { name: 'Imran Zakariya', house: 'Sunflower' },
        { name: 'Madhav Vyas', house: 'Sunflower' },
        { name: 'Sai Santhossh', house: 'Orchid' }
      ],
      'grade4_hyrox_girls': [
        { name: 'Dhriti Shetty', house: 'Hibiscus' },
        { name: 'Ameya Sharma', house: 'Sunflower' },
        { name: 'Prisha Magadum', house: 'Hibiscus' },
        { name: 'Riyanshi Ara', house: 'Orchid' },
        { name: 'Jingwen Zuo', house: 'Sunflower' },
        { name: 'Tia Karamchandani', house: 'Chrysanthemum' }
      ],
      'grade5_100m_boys': [
        { name: 'Abhinav Chakraborty', house: 'Chrysanthemum' },
        { name: 'Abhiraj Agrawal', house: 'Sunflower' },
        { name: 'Rishav Chakraborty', house: 'Chrysanthemum' },
        { name: 'Viraj Gavali', house: 'Orchid' },
        { name: 'Rehansh Khater', house: 'Orchid' },
        { name: 'Siddharth Bharath', house: 'Sunflower' },
        { name: 'Rajvir Pund', house: 'Orchid' },
        { name: 'Arjun Chakraborty', house: 'Chrysanthemum' },
        { name: 'Raghav Krishnan', house: 'Chrysanthemum' }
      ],
      'grade5_100m_girls': [
        { name: 'Akshainie Mahesh', house: 'Hibiscus' },
        { name: 'Adira Fahmida', house: 'Sunflower' },
        { name: 'Sanvi Singh', house: 'Orchid' },
        { name: 'Sophie Elizabeth', house: 'Sunflower' },
        { name: 'Jiaxuan (Melody)', house: 'Chrysanthemum' },
        { name: 'Yuva Dharshana', house: 'Chrysanthemum' },
        { name: 'Lakshana Muthukumar', house: 'Chrysanthemum' },
        { name: 'Varada Abhijeet', house: 'Hibiscus' }
      ],
      'grade5_hyrox_boys': [
        { name: 'Abhinav Chakraborty', house: 'Chrysanthemum' },
        { name: 'Abhiraj Agrawal', house: 'Sunflower' },
        { name: 'Rajvir Pund', house: 'Orchid' },
        { name: 'Arjun Chakraborty', house: 'Chrysanthemum' },
        { name: 'Rehansh Khater', house: 'Orchid' },
        { name: 'Raghav Krishnan', house: 'Chrysanthemum' }
      ],
      'grade5_hyrox_girls': [
        { name: 'Akshainie Mahesh', house: 'Hibiscus' },
        { name: 'Adira Fahmida', house: 'Sunflower' },
        { name: 'Sanvi Singh', house: 'Orchid' },
        { name: 'Sophie Elizabeth', house: 'Sunflower' },
        { name: 'Jiaxuan (Melody)', house: 'Chrysanthemum' },
        { name: 'Yuva Dharshana', house: 'Chrysanthemum' }
      ],
      'u12_100m_boys': [
        { name: 'Kanishk Ramiah', house: 'Hibiscus' },
        { name: 'Vairaaj Prasad', house: 'Chrysanthemum' },
        { name: 'Hariharan Venkatesh', house: 'Sunflower' },
        { name: 'Parth Tandon', house: 'Sunflower' },
        { name: 'Sailesh Senthilkumar', house: 'Chrysanthemum' },
        { name: 'Siddh Kachroo', house: 'Sunflower' },
        { name: 'Krithick Ramesh', house: 'Chrysanthemum' },
        { name: 'Yash Panigrahi', house: 'Hibiscus' },
        { name: 'Maadhav Anoop', house: 'Orchid' },
        { name: 'Kavin Saravanan', house: 'Orchid' }
      ],
      'u12_100m_girls': [
        { name: 'Naisha Deshmukh', house: 'Orchid' },
        { name: 'Krithi Gopalakrishnan', house: 'Chrysanthemum' },
        { name: 'Saanvi Singh', house: 'Orchid' },
        { name: 'Thira Thillai', house: 'Sunflower' },
        { name: 'A S Asmitha', house: 'Hibiscus' },
        { name: 'Diya Sreeja Rahul', house: 'Sunflower' },
        { name: 'Shivani Senthilkumar', house: 'Chrysanthemum' },
        { name: 'Arshitha Subramanian', house: 'Hibiscus' },
        { name: 'Diya Sharan', house: 'Sunflower' },
        { name: 'Danica Singh', house: 'Sunflower' }
      ],
      'u12_hyrox_boys': [
        { name: 'Krithick Ramesh', house: 'Chrysanthemum' },
        { name: 'Yash Panigrahi', house: 'Hibiscus' },
        { name: 'Kavin Saravanan', house: 'Orchid' },
        { name: 'Parth Hari', house: 'Sunflower' }
      ],
      'u12_hyrox_girls': [
        { name: 'Shivani Senthilkumar', house: 'Chrysanthemum' },
        { name: 'Arshitha Subramanian', house: 'Hibiscus' },
        { name: 'Saanvi Singh', house: 'Orchid' },
        { name: 'Diya Sharan', house: 'Sunflower' }
      ],
      'u14_100m_boys': [
        { name: 'Saavir Soni', house: 'Orchid' },
        { name: 'Vidyut Praveen', house: 'Hibiscus' },
        { name: 'Gautham Selvaganesh', house: 'Orchid' },
        { name: 'Shlok Verma', house: 'Sunflower' },
        { name: 'Vishruth Ramachandran', house: 'Orchid' },
        { name: 'Rishaan Patil', house: 'Sunflower' },
        { name: 'Samarth Singh', house: 'Chrysanthemum' },
        { name: 'Zimo Shao', house: 'Chrysanthemum' },
        { name: 'Akshaj Vinod', house: 'Hibiscus' },
        { name: 'Harsh Golchha', house: 'Sunflower' }
      ],
      'u14_100m_girls': [
        { name: 'Shriya Arunkumar', house: 'Sunflower' }
      ]
    };

    // --- Data ---
    let students = {};
    let houses = { 'Chrysanthemum':0, 'Hibiscus':0, 'Orchid':0, 'Sunflower':0 };
    let eventLog = [];

    const POINTS = { GOLD:100, SILVER:70, BRONZE:40, SCHOOL_JAM:200, TUG_OF_WAR:200 };

    // --- Storage ---
    function loadDataFromStorage(){
      try{
        const savedHouses = localStorage.getItem('sportsDay_houses');
        const savedStudents = localStorage.getItem('sportsDay_students');
        const savedEventLog = localStorage.getItem('sportsDay_eventLog');
        if(savedHouses) houses = JSON.parse(savedHouses);
        if(savedStudents) students = JSON.parse(savedStudents);
        if(savedEventLog) eventLog = JSON.parse(savedEventLog);
      }catch(e){ console.error('Error loading data', e); }
    }
    
    function saveDataToStorage(){
      try{
        localStorage.setItem('sportsDay_houses', JSON.stringify(houses));
        localStorage.setItem('sportsDay_students', JSON.stringify(students));
        localStorage.setItem('sportsDay_eventLog', JSON.stringify(eventLog));
      }catch(e){ console.error('Error saving data', e); }
    }

    // --- Tabs ---
    function showTab(evt, tabName){
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      const section = document.getElementById(tabName);
      if(section) section.classList.add('active');
      if(evt && evt.target) evt.target.classList.add('active');
      if(tabName==='athletes') updateAthleteLeaderboards();
      if(tabName==='houses') updateHouseStandings();
      if(tabName==='events') updateEventLog();
    }

    // --- Form logic ---
    function updateCategoryOptions(){
      const eventTypeEl = document.getElementById('eventType');
      const categoryEl = document.getElementById('category');
      if(!eventTypeEl || !categoryEl) return;
      const eventType = eventTypeEl.value;

      if(eventType==='school_jam' || eventType==='tug_of_war'){
        categoryEl.value = 'house_event'; 
        categoryEl.disabled = true;
        document.getElementById('silverSection').style.display='none';
        document.getElementById('bronzeSection').style.display='none';
        document.getElementById('goldWinnerContainer').innerHTML = '<input type="text" id="goldWinner" value="House Winner" readonly>';
      }else{
        categoryEl.disabled=false; 
        if(categoryEl.value==='house_event') categoryEl.value='';
        document.getElementById('silverSection').style.display='grid';
        document.getElementById('bronzeSection').style.display='grid';
        updateFormFields();
      }
    }

    function updateFormFields(){
      const eventType = document.getElementById('eventType')?.value || '';
      const category = document.getElementById('category')?.value || '';
      
      if(eventType==='school_jam' || eventType==='tug_of_war') return;
      
      if(category && category!=='house_event'){
        createStudentDropdowns(category);
      }
    }

    function createStudentDropdowns(category){
      const categoryStudents = STUDENT_DATABASE[category] || [];
      
      ['gold','silver','bronze'].forEach(position=>{
        const container = document.getElementById(position+'WinnerContainer'); 
        if(!container) return;
        
        let html = `<select id="${position}Winner" onchange="updateWinnerInfo('${position}')">`;
        html += '<option value="">Select Student</option>';
        
        categoryStudents.forEach(student => {
          html += `<option value="${student.name}" data-house="${student.house}">${student.name} (${student.house})</option>`;
        });
        
        html += '</select>';
        container.innerHTML = html;
      });
    }

    function updateWinnerInfo(position){
      const winnerEl = document.getElementById(position+'Winner');
      const houseSelect = document.getElementById(position+'House');
      const infoDiv = document.getElementById(position+'WinnerInfo');
      
      if(!winnerEl || !houseSelect || !infoDiv) return;
      
      const selectedOption = winnerEl.options[winnerEl.selectedIndex];
      if(selectedOption && selectedOption.dataset.house){
        houseSelect.value = selectedOption.dataset.house;
        infoDiv.textContent = `House: ${selectedOption.dataset.house}`;
      } else {
        infoDiv.textContent = '';
      }
    }

    function addResult(){
      const eventType = document.getElementById('eventType')?.value || '';
      const category = document.getElementById('category')?.value || '';
      const goldHouse = document.getElementById('goldHouse')?.value || '';

      if(!eventType){ 
        showAlert('Please select an event type.','error'); 
        return; 
      }

      if(eventType==='school_jam' || eventType==='tug_of_war'){
        if(!goldHouse){ 
          showAlert('Please select the winning house.','error'); 
          return; 
        }
        const points = (eventType==='school_jam')?POINTS.SCHOOL_JAM:POINTS.TUG_OF_WAR;
        houses[goldHouse] += points;
        eventLog.push({ 
          timestamp:new Date().toLocaleString(), 
          event:(eventType==='school_jam'?'School Jam':'Tug of War'), 
          category:'House Event', 
          winner:goldHouse, 
          points 
        });
        showAlert(`${eventType==='school_jam'?'School Jam':'Tug of War'} added! ${goldHouse} gains ${points} points.`,'success');
      }else{
        const goldWinner = document.getElementById('goldWinner')?.value || '';
        const silverWinner = document.getElementById('silverWinner')?.value || '';
        const silverHouse = document.getElementById('silverHouse')?.value || '';
        const bronzeWinner = document.getElementById('bronzeWinner')?.value || '';
        const bronzeHouse = document.getElementById('bronzeHouse')?.value || '';

        if(!goldWinner || !goldHouse){ 
          showAlert('Please fill in at least the gold winner and their house.','error'); 
          return; 
        }
        if(!category || category==='house_event'){ 
          showAlert('Please select a valid category for individual events.','error'); 
          return; 
        }

        if(goldWinner && goldHouse){ 
          addStudentResult(goldWinner, goldHouse, category, 'gold'); 
          houses[goldHouse] += POINTS.GOLD; 
        }
        if(silverWinner && silverHouse){ 
          addStudentResult(silverWinner, silverHouse, category, 'silver'); 
          houses[silverHouse] += POINTS.SILVER; 
        }
        if(bronzeWinner && bronzeHouse){ 
          addStudentResult(bronzeWinner, bronzeHouse, category, 'bronze'); 
          houses[bronzeHouse] += POINTS.BRONZE; 
        }

        eventLog.push({ 
          timestamp:new Date().toLocaleString(), 
          event:eventType, 
          category, 
          gold: goldWinner?`${goldWinner} (${goldHouse})`:'', 
          silver: silverWinner?`${silverWinner} (${silverHouse})`:'', 
          bronze: bronzeWinner?`${bronzeWinner} (${bronzeHouse})`:'' 
        });
        showAlert('Event results added successfully!','success');
      }
      
      saveDataToStorage(); 
      clearForm(); 
      updateStats();
      updateAthleteLeaderboards(); 
      updateHouseStandings(); 
      updateEventLog();
    }

    function addStudentResult(name, house, category, medal){
      if(!students[name]) students[name] = { house, category, gold:0, silver:0, bronze:0, totalPoints:0 };
      students[name][medal]++;
      students[name].totalPoints = students[name].gold*POINTS.GOLD + students[name].silver*POINTS.SILVER + students[name].bronze*POINTS.BRONZE;
    }

    function clearForm(){
      const ids = ['eventType','category','goldHouse','silverHouse','bronzeHouse'];
      ids.forEach(id=>{ 
        const el=document.getElementById(id); 
        if(el) el.value=''; 
      });
      
      // Reset winner dropdowns
      ['gold','silver','bronze'].forEach(position=>{
        const container = document.getElementById(position+'WinnerContainer');
        if(container) {
          container.innerHTML = `<select id="${position}Winner" onchange="updateWinnerInfo('${position}')">
            <option value="">Select Student</option>
          </select>`;
        }
        const info = document.getElementById(position+'WinnerInfo'); 
        if(info) info.textContent='';
      });
      
      const categoryEl = document.getElementById('category'); 
      if(categoryEl){ 
        categoryEl.disabled=false; 
      }
      document.getElementById('silverSection').style.display='grid';
      document.getElementById('bronzeSection').style.display='grid';
    }

    function showAlert(message, type){
      const alertDiv = document.getElementById('inputAlert');
      alertDiv.textContent = message; 
      alertDiv.style.display='block';
      alertDiv.className = (type==='success')?'alert alert-success':'alert alert-error';
      setTimeout(()=>{ 
        alertDiv.style.display='none'; 
      }, 3000);
    }

    function updateStats(){
      // Update total events
      document.getElementById('totalEvents').textContent = eventLog.length || '0';
      
      // Update total medals
      let totalMedals = 0;
      Object.values(students).forEach(s => {
        totalMedals += s.gold + s.silver + s.bronze;
      });
      document.getElementById('totalMedals').textContent = totalMedals || '0';
      
      // Update leading house
      const houseEntries = Object.entries(houses).sort(([,a],[,b])=>b-a);
      const leadingHouse = houseEntries[0];
      // Only show house name if they have points, otherwise show dash
      if (leadingHouse && leadingHouse[1] > 0) {
        document.getElementById('leadingHouse').textContent = leadingHouse[0];
      } else {
        document.getElementById('leadingHouse').textContent = '-';
      }
    }

    function updateAthleteLeaderboards(){
      const categories = Object.keys(STUDENT_DATABASE);
      const athleteResults = document.getElementById('athleteResults');
      
      let html = '';
      categories.forEach(cat => {
        if (cat === '4x100m_relay' || cat === 'tug_of_war') return; // Skip team events
        
        const categoryStudents = Object.entries(students)
          .filter(([n,d]) => d.category === cat)
          .sort(([,a],[,b]) => b.totalPoints - a.totalPoints);
        
        if (categoryStudents.length > 0) {
          const displayName = cat.replace(/_/g,' ').replace(/\b\w/g, l => l.toUpperCase());
          html += `<div class="results-card">
            <h3>${displayName}</h3>
            <ul class="leaderboard">`;
          
          categoryStudents.forEach(([name,data],idx) => {
            const medalClass = idx === 0 ? 'gold' : idx === 1 ? 'silver' : idx === 2 ? 'bronze' : '';
            html += `<li class="${medalClass}">
              <div class="student-info">
                <div class="student-name"><span class="house-colors ${data.house.toLowerCase()}"></span>${name}</div>
                <div class="student-details">${data.house} ‚Ä¢ Gold: ${data.gold} Silver: ${data.silver} Bronze: ${data.bronze}</div>
              </div>
              <div class="points">${data.totalPoints} pts</div>
            </li>`;
          });
          
          html += '</ul></div>';
        }
      });
      
      if (html === '') {
        html = '<div style="text-align:center; color:#666; grid-column:1/-1;">No results yet. Start adding event results!</div>';
      }
      
      athleteResults.innerHTML = html;
    }

    function updateHouseStandings(){
      const standings = Object.entries(houses).sort(([,a],[,b])=>b-a);
      const listElement = document.getElementById('house-standings'); 
      if(!listElement) return;
      listElement.innerHTML='';
      standings.forEach(([house,points],idx)=>{
        const li = document.createElement('li');
        if(idx===0) li.classList.add('gold'); 
        else if(idx===1) li.classList.add('silver'); 
        else if(idx===2) li.classList.add('bronze');
        li.innerHTML = `<div class="student-info">
          <div class="student-name"><span class="house-colors ${house.toLowerCase()}"></span>${house}</div>
          <div class="student-details">Position ${idx+1}</div>
        </div><div class="points">${points} pts</div>`;
        listElement.appendChild(li);
      });
    }

    function updateEventLog(){
      const logElement = document.getElementById('eventLog'); 
      if(!logElement) return;
      if(eventLog.length===0){ 
        logElement.innerHTML = '<p style="text-align:center;color:#666;">No events recorded yet. Start adding results!</p>'; 
        return; 
      }
      logElement.innerHTML='';
      eventLog.slice().reverse().forEach(ev=>{
        const div = document.createElement('div'); 
        div.className='event-entry';
        if(ev.category==='House Event'){
          div.innerHTML = `<strong>${ev.event}</strong> - ${ev.timestamp}<br>Winner: ${ev.winner} House - ${ev.points} points`;
        }else{
          let resultsHTML = `<strong>${ev.event}</strong> (${ev.category.replace(/_/g,' ').toUpperCase()}) - ${ev.timestamp}<br>`;
          if(ev.gold) resultsHTML += `Gold: ${ev.gold}<br>`;
          if(ev.silver) resultsHTML += `Silver: ${ev.silver}<br>`;
          if(ev.bronze) resultsHTML += `Bronze: ${ev.bronze}`;
          div.innerHTML = resultsHTML;
        }
        logElement.appendChild(div);
      });
    }

    function exportResults(){
      let csvContent = "Sports Day 2025 Results\n\n";
      csvContent += "BEST ATHLETES\n\n";
      const cats = Object.keys(STUDENT_DATABASE);
      cats.forEach(cat=>{
        const namePretty = cat.replace(/_/g,' ').replace(/\b\w/g,l=>l.toUpperCase());
        csvContent += `${namePretty}\nRank,Name,House,Gold,Silver,Bronze,Total Points\n`;
        const categoryStudents = Object.entries(students)
          .filter(([n,d])=>d.category===cat)
          .sort(([,a],[,b])=>b.totalPoints - a.totalPoints);
        categoryStudents.forEach(([name,data],i)=>{
          csvContent += `${i+1},${name},${data.house},${data.gold},${data.silver},${data.bronze},${data.totalPoints}\n`;
        });
        csvContent += "\n";
      });
      csvContent += "\nHOUSE CHAMPIONSHIP\nRank,House,Total Points\n";
      const standings = Object.entries(houses).sort(([,a],[,b])=>b-a);
      standings.forEach(([house,points],i)=>{ 
        csvContent += `${i+1},${house},${points}\n`; 
      });
      csvContent += "\n\nEVENT LOG\nTimestamp,Event,Category,Gold,Silver,Bronze\n";
      eventLog.forEach(ev=>{
        if(ev.category==='House Event'){ 
          csvContent += `${ev.timestamp},${ev.event},${ev.category},${ev.winner} (${ev.points} pts),,\n`; 
        }
        else { 
          csvContent += `${ev.timestamp},${ev.event},${ev.category},${ev.gold},${ev.silver},${ev.bronze}\n`; 
        }
      });
      const blob = new Blob([csvContent],{type:'text/csv'});
      const url = URL.createObjectURL(blob); 
      const a=document.createElement('a'); 
      a.href=url; 
      a.download=`Sports_Day_2025_Results_${new Date().toISOString().split('T')[0]}.csv`; 
      a.click(); 
      URL.revokeObjectURL(url);
      showAlert('Results exported successfully!','success');
    }

    function clearAllData(){
      if(!confirm('Are you sure you want to clear all data? This cannot be undone.')) return;
      
      // Reset all data
      students = {}; 
      houses = { 'Chrysanthemum':0, 'Hibiscus':0, 'Orchid':0, 'Sunflower':0 }; 
      eventLog = [];
      
      // Clear localStorage
      try {
        localStorage.removeItem('sportsDay_houses');
        localStorage.removeItem('sportsDay_students');
        localStorage.removeItem('sportsDay_eventLog');
      } catch(e) {
        console.error('Error clearing storage:', e);
      }
      
      // Update all displays
      updateStats();
      updateAthleteLeaderboards(); 
      updateHouseStandings(); 
      updateEventLog();
      
      // Show confirmation
      showAlert('All data cleared successfully! The system has been reset.','success');
      
      // Also clear the form just in case
      clearForm();
    }

    // --- Init ---
    loadDataFromStorage(); 
    updateStats();
    updateAthleteLeaderboards(); 
    updateHouseStandings(); 
    updateEventLog();
  </script>
</body>
</html>' },
        { name: 'Smriti Mahesh', house: 'Chrysanthemum' },
        { name: 'Oviya Bhaskar', house: 'Hibiscus' },
        { name: 'Yashasvi Saxena', house: 'Chrysanthemum' },
        { name: 'Nikita Mallick', house: 'Chrysanthemum' },
        { name: 'Yashvi Agrawal', house: 'Chrysanthemum' },
        { name: 'Rucha Sachin', house: 'Hibiscus' },
        { name: 'Mitali Singh', house: 'Orchid' },
        { name: 'Sara Balakrishnan', house: 'Orchid' },
        { name: 'Vibha Sriram', house: 'Sunflower' }
      ],
      'u14_hyrox_boys': [
        { name: 'Zimo Shao', house: 'Chrysanthemum' },
        { name: 'Akshaj Vinod', house: 'Hibiscus' },
        { name: 'Saavir Soni', house: 'Orchid' },
        { name: 'Harsh Golchha', house: 'Sunflower' }
      ],
      'u14_hyrox_girls': [
        { name: 'Smriti Mahesh', house: 'Chrysanthemum' },
        { name: 'Rucha Sachin', house: 'Hibiscus' },
        { name: 'Mitali Singh', house: 'Orchid' },
        { name: 'Vibha Sriram', house: 'Sunflower' }
      ],
      'u16_100m_boys': [
        { name: 'Sharvesh Senthil', house: 'Chrysanthemum' },
        { name: 'Divit Turakhiya', house: 'Orchid' },
        { name: 'Rudransh Arora', house: 'Orchid' },
        { name: 'Soham Sharma', house: 'Orchid' },
        { name: 'Yujin Kobayashi', house: 'Sunflower' },
        { name: 'Abeer Nitin', house: 'Chrysanthemum' },
        { name: 'Avyukth Raghavendra', house: 'Chrysanthemum' },
        { name: 'Aarav Singh', house: 'Hibiscus' },
        { name: 'Israel Aaron', house: 'Hibiscus' },
        { name: 'Pranav Ramnath', house: 'Sunflower' }
      ],
      'u16_100m_girls': [
        { name: 'Harshadha Ganapathiraman', house: 'Chrysanthemum' },
        { name: 'Aster Coelho', house: 'Chrysanthemum' },
        { name: 'Yudan Zhang (Rina)', house: 'Sunflower' },
        { name: 'Mishika Gudipudi', house: 'Orchid' },
        { name: 'Yuxiao Yang (Jewelry)', house: 'Sunflower' },
        { name: 'Zhen Li', house: 'Sunflower' }
      ],
      'u16_hyrox_boys': [
        { name: 'Avyukth Raghavendra', house: 'Chrysanthemum' },
        { name: 'Israel Aaron', house: 'Hibiscus' },
        { name: 'Divit Turakhiya', house: 'Orchid' },
        { name: 'Pranav Ramnath', house: 'Sunflower' }
      ],
      'u16_hyrox_girls': [
        { name: 'Harshadha Ganapathiraman', house: 'Chrysanthemum' },
        { name: 'Aster Coelho', house: 'Chrysanthemum' },
        { name: 'Mishika Gudipudi', house: 'Orchid' },
        { name: 'Yudan Zhang (Rina)', house: 'Sunflower' }
      ],
      '4x100m_relay': [
        { name: 'Mohammed Mohiuddin', house: 'Chrysanthemum' },
        { name: 'Aarav Singh', house: 'Hibiscus' },
        { name: 'Soham Sharma', house: 'Orchid' },
        { name: 'Pranav Ramnath', house: 'Sunflower' },
        { name: 'Smriti Mahesh', house: 'Chrysanthemum' },
        { name: 'Oviya Bhaskar', house: 'Hibiscus' },
        { name: 'Sara Balakrishnan', house: 'Orchid' },
        { name: 'Shriya Arunkumar', house: 'Sunflower

    // --- Data ---
    let students = {};
    let houses = { 'Chrysanthemum':0, 'Hibiscus':0, 'Orchid':0, 'Sunflower':0 };
    let eventLog = [];

    const POINTS = { GOLD:100, SILVER:70, BRONZE:40, SCHOOL_JAM:200, TUG_OF_WAR:200 };

    // --- Storage ---
    function loadDataFromStorage(){
      try{
        const savedHouses = localStorage.getItem('sportsDay_houses');
        const savedStudents = localStorage.getItem('sportsDay_students');
        const savedEventLog = localStorage.getItem('sportsDay_eventLog');
        if(savedHouses) houses = JSON.parse(savedHouses);
        if(savedStudents) students = JSON.parse(savedStudents);
        if(savedEventLog) eventLog = JSON.parse(savedEventLog);
      }catch(e){ console.error('Error loading data', e); }
    }
    
    function saveDataToStorage(){
      try{
        localStorage.setItem('sportsDay_houses', JSON.stringify(houses));
        localStorage.setItem('sportsDay_students', JSON.stringify(students));
        localStorage.setItem('sportsDay_eventLog', JSON.stringify(eventLog));
      }catch(e){ console.error('Error saving data', e); }
    }

    // --- Tabs ---
    function showTab(evt, tabName){
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      const section = document.getElementById(tabName);
      if(section) section.classList.add('active');
      if(evt && evt.target) evt.target.classList.add('active');
      if(tabName==='athletes') updateAthleteLeaderboards();
      if(tabName==='houses') updateHouseStandings();
      if(tabName==='events') updateEventLog();
    }

    // --- Form logic ---
    function updateCategoryOptions(){
      const eventTypeEl = document.getElementById('eventType');
      const categoryEl = document.getElementById('category');
      if(!eventTypeEl || !categoryEl) return;
      const eventType = eventTypeEl.value;

      if(eventType==='school_jam' || eventType==='tug_of_war'){
        categoryEl.value = 'house_event'; 
        categoryEl.disabled = true;
        document.getElementById('silverSection').style.display='none';
        document.getElementById('bronzeSection').style.display='none';
        document.getElementById('goldWinnerContainer').innerHTML = '<input type="text" id="goldWinner" value="House Winner" readonly>';
      }else{
        categoryEl.disabled=false; 
        if(categoryEl.value==='house_event') categoryEl.value='';
        document.getElementById('silverSection').style.display='grid';
        document.getElementById('bronzeSection').style.display='grid';
        updateFormFields();
      }
    }

    function updateFormFields(){
      const eventType = document.getElementById('eventType')?.value || '';
      const category = document.getElementById('category')?.value || '';
      
      if(eventType==='school_jam' || eventType==='tug_of_war') return;
      
      if(category && category!=='house_event'){
        createStudentDropdowns(category);
      }
    }

    function createStudentDropdowns(category){
      const categoryStudents = STUDENT_DATABASE[category] || [];
      
      ['gold','silver','bronze'].forEach(position=>{
        const container = document.getElementById(position+'WinnerContainer'); 
        if(!container) return;
        
        let html = `<select id="${position}Winner" onchange="updateWinnerInfo('${position}')">`;
        html += '<option value="">Select Student</option>';
        
        categoryStudents.forEach(student => {
          html += `<option value="${student.name}" data-house="${student.house}">${student.name} (${student.house})</option>`;
        });
        
        html += '</select>';
        container.innerHTML = html;
      });
    }

    function updateWinnerInfo(position){
      const winnerEl = document.getElementById(position+'Winner');
      const houseSelect = document.getElementById(position+'House');
      const infoDiv = document.getElementById(position+'WinnerInfo');
      
      if(!winnerEl || !houseSelect || !infoDiv) return;
      
      const selectedOption = winnerEl.options[winnerEl.selectedIndex];
      if(selectedOption && selectedOption.dataset.house){
        houseSelect.value = selectedOption.dataset.house;
        infoDiv.textContent = `House: ${selectedOption.dataset.house}`;
      } else {
        infoDiv.textContent = '';
      }
    }

    function addResult(){
      const eventType = document.getElementById('eventType')?.value || '';
      const category = document.getElementById('category')?.value || '';
      const goldHouse = document.getElementById('goldHouse')?.value || '';

      if(!eventType){ 
        showAlert('Please select an event type.','error'); 
        return; 
      }

      if(eventType==='school_jam' || eventType==='tug_of_war'){
        if(!goldHouse){ 
          showAlert('Please select the winning house.','error'); 
          return; 
        }
        const points = (eventType==='school_jam')?POINTS.SCHOOL_JAM:POINTS.TUG_OF_WAR;
        houses[goldHouse] += points;
        eventLog.push({ 
          timestamp:new Date().toLocaleString(), 
          event:(eventType==='school_jam'?'School Jam':'Tug of War'), 
          category:'House Event', 
          winner:goldHouse, 
          points 
        });
        showAlert(`${eventType==='school_jam'?'School Jam':'Tug of War'} added! ${goldHouse} gains ${points} points.`,'success');
      }else{
        const goldWinner = document.getElementById('goldWinner')?.value || '';
        const silverWinner = document.getElementById('silverWinner')?.value || '';
        const silverHouse = document.getElementById('silverHouse')?.value || '';
        const bronzeWinner = document.getElementById('bronzeWinner')?.value || '';
        const bronzeHouse = document.getElementById('bronzeHouse')?.value || '';

        if(!goldWinner || !goldHouse){ 
          showAlert('Please fill in at least the gold winner and their house.','error'); 
          return; 
        }
        if(!category || category==='house_event'){ 
          showAlert('Please select a valid category for individual events.','error'); 
          return; 
        }

        if(goldWinner && goldHouse){ 
          addStudentResult(goldWinner, goldHouse, category, 'gold'); 
          houses[goldHouse] += POINTS.GOLD; 
        }
        if(silverWinner && silverHouse){ 
          addStudentResult(silverWinner, silverHouse, category, 'silver'); 
          houses[silverHouse] += POINTS.SILVER; 
        }
        if(bronzeWinner && bronzeHouse){ 
          addStudentResult(bronzeWinner, bronzeHouse, category, 'bronze'); 
          houses[bronzeHouse] += POINTS.BRONZE; 
        }

        eventLog.push({ 
          timestamp:new Date().toLocaleString(), 
          event:eventType, 
          category, 
          gold: goldWinner?`${goldWinner} (${goldHouse})`:'', 
          silver: silverWinner?`${silverWinner} (${silverHouse})`:'', 
          bronze: bronzeWinner?`${bronzeWinner} (${bronzeHouse})`:'' 
        });
        showAlert('Event results added successfully!','success');
      }
      
      saveDataToStorage(); 
      clearForm(); 
      updateStats();
      updateAthleteLeaderboards(); 
      updateHouseStandings(); 
      updateEventLog();
    }

    function addStudentResult(name, house, category, medal){
      if(!students[name]) students[name] = { house, category, gold:0, silver:0, bronze:0, totalPoints:0 };
      students[name][medal]++;
      students[name].totalPoints = students[name].gold*POINTS.GOLD + students[name].silver*POINTS.SILVER + students[name].bronze*POINTS.BRONZE;
    }

    function clearForm(){
      const ids = ['eventType','category','goldHouse','silverHouse','bronzeHouse'];
      ids.forEach(id=>{ 
        const el=document.getElementById(id); 
        if(el) el.value=''; 
      });
      
      // Reset winner dropdowns
      ['gold','silver','bronze'].forEach(position=>{
        const container = document.getElementById(position+'WinnerContainer');
        if(container) {
          container.innerHTML = `<select id="${position}Winner" onchange="updateWinnerInfo('${position}')">
            <option value="">Select Student</option>
          </select>`;
        }
        const info = document.getElementById(position+'WinnerInfo'); 
        if(info) info.textContent='';
      });
      
      const categoryEl = document.getElementById('category'); 
      if(categoryEl){ 
        categoryEl.disabled=false; 
      }
      document.getElementById('silverSection').style.display='grid';
      document.getElementById('bronzeSection').style.display='grid';
    }

    function showAlert(message, type){
      const alertDiv = document.getElementById('inputAlert');
      alertDiv.textContent = message; 
      alertDiv.style.display='block';
      alertDiv.className = (type==='success')?'alert alert-success':'alert alert-error';
      setTimeout(()=>{ 
        alertDiv.style.display='none'; 
      }, 3000);
    }

    function updateStats(){
      // Update total events
      document.getElementById('totalEvents').textContent = eventLog.length || '0';
      
      // Update total medals
      let totalMedals = 0;
      Object.values(students).forEach(s => {
        totalMedals += s.gold + s.silver + s.bronze;
      });
      document.getElementById('totalMedals').textContent = totalMedals || '0';
      
      // Update leading house
      const houseEntries = Object.entries(houses).sort(([,a],[,b])=>b-a);
      const leadingHouse = houseEntries[0];
      // Only show house name if they have points, otherwise show dash
      if (leadingHouse && leadingHouse[1] > 0) {
        document.getElementById('leadingHouse').textContent = leadingHouse[0];
      } else {
        document.getElementById('leadingHouse').textContent = '-';
      }
    }

    function updateAthleteLeaderboards(){
      const categories = ['grade4_100m','grade4_hyrox','grade5_100m','grade5_hyrox',
                         'u12_100m','u12_hyrox','u14_100m','u14_hyrox',
                         'u16_100m','u16_hyrox','4x100m_relay'];
      categories.forEach(cat=>{
        const listElement = document.getElementById(cat.replace('_','-')+'-list'); 
        if(!listElement) return;
        const categoryStudents = Object.entries(students)
          .filter(([n,d])=>d.category===cat)
          .sort(([,a],[,b])=>b.totalPoints - a.totalPoints);
        listElement.innerHTML='';
        if(categoryStudents.length===0){ 
          listElement.innerHTML = '<li style="text-align:center;color:#666;">No results yet</li>'; 
          return; 
        }
        categoryStudents.forEach(([name,data],idx)=>{
          const li = document.createElement('li');
          if(idx===0) li.classList.add('gold'); 
          else if(idx===1) li.classList.add('silver'); 
          else if(idx===2) li.classList.add('bronze');
          li.innerHTML = `<div class="student-info">
            <div class="student-name"><span class="house-colors ${data.house.toLowerCase()}"></span>${name}</div>
            <div class="student-details">${data.house} ‚Ä¢ ü•á${data.gold} ü•à${data.silver} ü•â${data.bronze}</div>
          </div><div class="points">${data.totalPoints} pts</div>`;
          listElement.appendChild(li);
        });
      });
    }

    function updateHouseStandings(){
      const standings = Object.entries(houses).sort(([,a],[,b])=>b-a);
      const listElement = document.getElementById('house-standings'); 
      if(!listElement) return;
      listElement.innerHTML='';
      standings.forEach(([house,points],idx)=>{
        const li = document.createElement('li');
        if(idx===0) li.classList.add('gold'); 
        else if(idx===1) li.classList.add('silver'); 
        else if(idx===2) li.classList.add('bronze');
        li.innerHTML = `<div class="student-info">
          <div class="student-name"><span class="house-colors ${house.toLowerCase()}"></span>${house}</div>
          <div class="student-details">Position ${idx+1}</div>
        </div><div class="points">${points} pts</div>`;
        listElement.appendChild(li);
      });
    }

    function updateEventLog(){
      const logElement = document.getElementById('eventLog'); 
      if(!logElement) return;
      if(eventLog.length===0){ 
        logElement.innerHTML = '<p style="text-align:center;color:#666;">No events recorded yet. Start adding results!</p>'; 
        return; 
      }
      logElement.innerHTML='';
      eventLog.slice().reverse().forEach(ev=>{
        const div = document.createElement('div'); 
        div.className='event-entry';
        if(ev.category==='House Event'){
          div.innerHTML = `<strong>${ev.event}</strong> - ${ev.timestamp}<br>Winner: ${ev.winner} House - ${ev.points} points`;
        }else{
          div.innerHTML = `<strong>${ev.event}</strong> (${ev.category.replace('_',' ').toUpperCase()}) - ${ev.timestamp}<br>
            ${ev.gold?`ü•á ${ev.gold}<br>`:''}${ev.silver?`ü•à ${ev.silver}<br>`:''}${ev.bronze?`ü•â ${ev.bronze}`:''}`;
        }
        logElement.appendChild(div);
      });
    }

    function exportResults(){
      let csvContent = "Sports Day 2025 Results\n\n";
      csvContent += "BEST ATHLETES\n\n";
      const cats = ['grade4_100m','grade4_hyrox','grade5_100m','grade5_hyrox',
                    'u12_100m','u12_hyrox','u14_100m','u14_hyrox',
                    'u16_100m','u16_hyrox','4x100m_relay'];
      cats.forEach(cat=>{
        const namePretty = cat.replace(/_/g,' ').replace(/\b\w/g,l=>l.toUpperCase());
        csvContent += `${namePretty}\nRank,Name,House,Gold,Silver,Bronze,Total Points\n`;
        const categoryStudents = Object.entries(students)
          .filter(([n,d])=>d.category===cat)
          .sort(([,a],[,b])=>b.totalPoints - a.totalPoints);
        categoryStudents.forEach(([name,data],i)=>{
          csvContent += `${i+1},${name},${data.house},${data.gold},${data.silver},${data.bronze},${data.totalPoints}\n`;
        });
        csvContent += "\n";
      });
      csvContent += "\nHOUSE CHAMPIONSHIP\nRank,House,Total Points\n";
      const standings = Object.entries(houses).sort(([,a],[,b])=>b-a);
      standings.forEach(([house,points],i)=>{ 
        csvContent += `${i+1},${house},${points}\n`; 
      });
      csvContent += "\n\nEVENT LOG\nTimestamp,Event,Category,Gold,Silver,Bronze\n";
      eventLog.forEach(ev=>{
        if(ev.category==='House Event'){ 
          csvContent += `${ev.timestamp},${ev.event},${ev.category},${ev.winner} (${ev.points} pts),,\n`; 
        }
        else { 
          csvContent += `${ev.timestamp},${ev.event},${ev.category},${ev.gold},${ev.silver},${ev.bronze}\n`; 
        }
      });
      const blob = new Blob([csvContent],{type:'text/csv'});
      const url = URL.createObjectURL(blob); 
      const a=document.createElement('a'); 
      a.href=url; 
      a.download=`Sports_Day_2025_Results_${new Date().toISOString().split('T')[0]}.csv`; 
      a.click(); 
      URL.revokeObjectURL(url);
      showAlert('Results exported successfully!','success');
    }

    function clearAllData(){
      if(!confirm('Are you sure you want to clear all data? This cannot be undone.')) return;
      
      // Reset all data
      students = {}; 
      houses = { 'Chrysanthemum':0, 'Hibiscus':0, 'Orchid':0, 'Sunflower':0 }; 
      eventLog = [];
      
      // Clear localStorage
      try {
        localStorage.removeItem('sportsDay_houses');
        localStorage.removeItem('sportsDay_students');
        localStorage.removeItem('sportsDay_eventLog');
      } catch(e) {
        console.error('Error clearing storage:', e);
      }
      
      // Update all displays
      updateStats();
      updateAthleteLeaderboards(); 
      updateHouseStandings(); 
      updateEventLog();
      
      // Show confirmation
      showAlert('All data cleared successfully! The system has been reset.','success');
      
      // Also clear the form just in case
      clearForm();
    }

    // --- Init ---
    loadDataFromStorage(); 
    updateStats();
    updateAthleteLeaderboards(); 
    updateHouseStandings(); 
    updateEventLog();
  </script>
</body>
</html>

    
